<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<meta name="description" content="A size-optimized, customizable and open-source full-scale 32-bit RISC-V soft-core CPU and SoC written in platform-independent VHDL.">
<meta name="author" content="Dipl.-Ing. Stephan Nolting">
<link rel="icon" type="image/png" href="../img/icon.png">
<title>[User Guide] The NEORV32 RISC-V Processor</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The NEORV32 RISC-V Processor: User Guide</h1>
<div class="details">
<span id="author" class="author">Dipl.-Ing. Stephan Nolting</span><br>
<span id="email" class="email"><a href="mailto:stnolting@gmail.com">stnolting@gmail.com</a></span><br>
<span id="revnumber">version v1.5.6.0-r163-g0d5303f</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_toolchain_setup">1. Toolchain Setup</a>
<ul class="sectlevel2">
<li><a href="#_building_the_toolchain_from_scratch">1.1. Building the Toolchain from Scratch</a></li>
<li><a href="#_downloading_and_installing_a_prebuilt_toolchain">1.2. Downloading and Installing a Prebuilt Toolchain</a></li>
<li><a href="#_installation">1.3. Installation</a></li>
<li><a href="#_testing_the_installation">1.4. Testing the Installation</a></li>
</ul>
</li>
<li><a href="#_general_hardware_setup">2. General Hardware Setup</a></li>
<li><a href="#_general_software_framework_setup">3. General Software Framework Setup</a></li>
<li><a href="#_application_program_compilation">4. Application Program Compilation</a></li>
<li><a href="#_uploading_and_starting_of_a_binary_executable_image_via_uart">5. Uploading and Starting of a Binary Executable Image via UART</a></li>
<li><a href="#_setup_of_a_new_application_program_project">6. Setup of a New Application Program Project</a></li>
<li><a href="#_enabling_risc_v_cpu_extensions">7. Enabling RISC-V CPU Extensions</a></li>
<li><a href="#_building_a_non_volatile_application_without_external_boot_memory">8. Building a Non-Volatile Application without External Boot Memory</a></li>
<li><a href="#_customizing_the_internal_bootloader">9. Customizing the Internal Bootloader</a></li>
<li><a href="#_programming_an_external_spi_flash_via_the_bootloader">10. Programming an External SPI Flash via the Bootloader</a></li>
<li><a href="#_simulating_the_processor">11. Simulating the Processor</a></li>
<li><a href="#_building_the_documentation">12. Building the Documentation</a></li>
<li><a href="#_building_the_project_documentation">13. Building the Project Documentation</a></li>
<li><a href="#_freertos_support">14. FreeRTOS Support</a></li>
<li><a href="#_risc_v_architecture_test_framework">15. RISC-V Architecture Test Framework</a></li>
<li><a href="#_debugging_using_the_on_chip_debugger">16. Debugging using the On-Chip Debugger</a>
<ul class="sectlevel2">
<li><a href="#_hardware_requirements">16.1. Hardware Requirements</a></li>
<li><a href="#_openocd">16.2. OpenOCD</a></li>
<li><a href="#_debugging_with_gdb">16.3. Debugging with GDB</a>
<ul class="sectlevel3">
<li><a href="#_breakpoint_example">16.3.1. Breakpoint Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_legal">17. Legal</a>
<ul class="sectlevel2">
<li><a href="#_license">License</a></li>
<li><a href="#_proprietary_notice">Proprietary Notice</a></li>
<li><a href="#_disclaimer">Disclaimer</a></li>
<li><a href="#_limitation_of_liability_for_external_links">Limitation of Liability for External Links</a></li>
<li><a href="#_citing">Citing</a></li>
<li><a href="#_acknowledgments">Acknowledgments</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="../img/neorv32_logo_transparent.png" alt="neorv32 logo transparent">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../img/riscv_logo.png" alt="riscv logo" width="350">
</div>
</div>
<div class="paragraph text-center">
<p><a href="https://github.com/stnolting/neorv32"><span class="image"><img src="https://img.shields.io/badge/GitHub-stnolting%2Fneorv32-ffbd00?style=flat-square&amp;logo=github&amp;" alt="GitHub stnolting%2Fneorv32 ffbd00?style=flat square&amp;logo=github&amp;" title="homepage"></span></a>
<a href="https://github.com/stnolting/neorv32/blob/master/LICENSE"><span class="image"><img src="https://img.shields.io/github/license/stnolting/neorv32?longCache=true&amp;style=flat-square" alt="neorv32?longCache=true&amp;style=flat square" title="license"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/data%20sheet-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="data%20sheet PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="datasheet (pdf)"></span></a>
<a href="https://stnolting.github.io/neorv32"><span class="image"><img src="https://img.shields.io/badge/-HTML-ffbd00?longCache=true&amp;style=flat-square" alt=" HTML ffbd00?longCache=true&amp;style=flat square" title="datasheet (html)"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/user%20guide-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="user%20guide PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="userguide (pdf)"></span></a>
<a href="https://stnolting.github.io/neorv32/sw/files.html"><span class="image"><img src="https://img.shields.io/badge/doxygen-HTML-ffbd00?longCache=true&amp;style=flat-square&amp;logo=Doxygen" alt="doxygen HTML ffbd00?longCache=true&amp;style=flat square&amp;logo=Doxygen" title="doxygen"></span></a></p>
</div>
<div class="paragraph">
<p>Let&#8217;s Get It Started!</p>
</div>
<div class="paragraph">
<p>To make your NEORV32 project run, follow the guides from the upcoming sections. Follow these guides
step by step and in the presented order.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_toolchain_setup">1. Toolchain Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two possibilities to get the actual RISC-V GCC toolchain:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and <em>build</em> the official RISC-V GNU toolchain yourself</p>
</li>
<li>
<p>Download and install a prebuilt version of the toolchain</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default toolchain prefix for this project is <strong><code>riscv32-unknown-elf</code></strong>. Of course you can use any other RISC-V
toolchain (like <code>riscv64-unknown-elf</code>) that is capable to emit code for a <code>rv32</code> architecture. Just change the <em>RISCV_TOOLCHAIN</em> variable in the application
makefile(s) according to your needs or define this variable when invoking the makefile.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Keep in mind that – for instance – a rv32imc toolchain only provides library code compiled with
compressed (<em>C</em>) and <code>mul</code>/<code>div</code> instructions (<em>M</em>)! Hence, this code cannot be executed (without
emulation) on an architecture without these extensions!
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_building_the_toolchain_from_scratch">1.1. Building the Toolchain from Scratch</h3>
<div class="paragraph">
<p>To build the toolchain by yourself you can follow the guide from the official <a href="https://github.com/riscv/riscvgnu-toolchain" class="bare">https://github.com/riscv/riscvgnu-toolchain</a> GitHub page.</p>
</div>
<div class="paragraph">
<p>The official RISC-V repository uses submodules. You need the <code>--recursive</code> option to fetch the submodules
automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ git clone --recursive https://github.com/riscv/riscv-gnu-toolchain</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download and install the prerequisite standard packages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo apt-get install autoconf automake autotools-dev curl python3 libmpc-dev libmpfrdev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>To build the Linux cross-compiler, pick an install path. If you choose, say, <code>/opt/riscv</code>, then add
<code>/opt/riscv/bin</code> to your <code>PATH</code> variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ export PATH=$PATH:/opt/riscv/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, simply run the following commands and configuration in the RISC-V GNU toolchain source folder to compile a
<code>rv32i</code> toolchain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">riscv-gnu-toolchain$ ./configure --prefix=/opt/riscv --with-arch=rv32i –-with-abi=ilp32
riscv-gnu-toolchain$ make</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a while you will get <code>riscv32-unknown-elf-gcc</code> and all of its friends in your <code>/opt/riscv/bin</code> folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_downloading_and_installing_a_prebuilt_toolchain">1.2. Downloading and Installing a Prebuilt Toolchain</h3>
<div class="paragraph">
<p>Alternatively, you can download a prebuilt toolchain.</p>
</div>
<div class="paragraph">
<p><strong>Use The Toolchain I have Build</strong></p>
</div>
<div class="paragraph">
<p>I have compiled the toolchain on a 64-bit x86 Ubuntu (Ubuntu on Windows, actually) and uploaded it to
GitHub. You can directly download the according toolchain archive as single <em>zip-file</em> within a packed
release from github.com/stnolting/riscv-gcc-prebuilt.</p>
</div>
<div class="paragraph">
<p>Unpack the downloaded toolchain archive and copy the content to a location in your file system (e.g.
<code>/opt/riscv</code>). More information about downloading and installing my prebuilt toolchains can be found in
the repository&#8217;s README.</p>
</div>
<div class="paragraph">
<p><strong>Use a Third Party Toolchain</strong></p>
</div>
<div class="paragraph">
<p>Of course you can also use any other prebuilt version of the toolchain. There are a lot  RISC-V GCC packages out there -
even for Windows.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure the toolchain can (also) emit code for a <code>rv32i</code> architecture, uses the <code>ilp32</code> or <code>ilp32e</code> ABI and <strong>was not build</strong> using
CPU extensions that are not supported by the NEORV32 (like <code>D</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_installation">1.3. Installation</h3>
<div class="paragraph">
<p>Now you have the binaries. The last step is to add them to your <code>PATH</code> environment variable (if you have not
already done so). Make sure to add the binaries folder (<code>bin</code>) of your toolchain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ export PATH:$PATH:/opt/riscv/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should add this command to your <code>.bashrc</code> (if you are using bash) to automatically add the RISC-V
toolchain at every console start.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_installation">1.4. Testing the Installation</h3>
<div class="paragraph">
<p>To make sure everything works fine, navigate to an example project in the NEORV32 example folder and
execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make check</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will test all the tools required for the NEORV32. Everything is working fine if "Toolchain check OK" appears at the end.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general_hardware_setup">2. General Hardware Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following steps are required to generate a bitstream for your FPGA board. If you want to run the
NEORV32 processor in simulation only, the following steps might also apply.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Check out the example setups in the <code>setups</code> folder (@GitHub: <a href="https://github.com/stnolting/neorv32/tree/master/setups" class="bare">https://github.com/stnolting/neorv32/tree/master/setups</a>),
which provides (script-based) demo setups for various FPGA boards and toolchains.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this tutorial we will use a test implementation of the processor – using many of the processor&#8217;s optional
modules but just propagating the minimal signals to the outer world. Hence, this guide is intended as
evaluation or "hello world" project to check out the NEORV32. A little note: The order of the following
steps might be a little different for your specific EDA tool.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="0">
<li>
<p>Create a new project with your FPGA EDA tool of choice.</p>
</li>
<li>
<p>Add all VHDL files from the project&#8217;s <code>rtl/core</code> folder to your project. Make sure to <em>reference</em> the
files only – do not copy them.</p>
</li>
<li>
<p>Make sure to add all the rtl files to a new library called <strong><code>neorv32</code></strong>. If your FPGA tools does not
provide a field to enter the library name, check out the "properties" menu of the rtl files.</p>
</li>
<li>
<p>The <code>rtl/core/neorv32_top.vhd</code> VHDL file is the top entity of the NEORV32 processor. If you
already have a design, instantiate this unit into your design and proceed.</p>
</li>
<li>
<p>If you do not have a design yet and just want to check out the NEORV32 – no problem! In this guide
we will use a simplified top entity, that encapsulated the actual processor top entity: add the
<code>rtl/templates/processor/neorv32_ProcessorTop_Test.vhd</code> VHDL file to your project too, and
select it as top entity.</p>
</li>
<li>
<p>This test setup provides a minimal test hardware setup:</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../img/neorv32_test_setup.png" alt="neorv32 test setup">
</div>
<div class="title">Figure 1. NEORV32 "hello world" test setup</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>This test setup only implements some very basic processor and CPU features. Also, only the
minimum number of signals is propagated to the outer world. Please note that the reset input signal
<code>rstn_i</code> is <strong>low-active</strong>.</p>
</li>
<li>
<p>The configuration of the NEORV32 processor is done using the generics of the instantiated processor
top entity. Let&#8217;s keep things simple at first and use the default configuration:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 1. Cut-out of <code>neorv32_test_setup.vhd</code> showing the processor instance and its configuration</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">neorv32_top_inst: neorv32_top
generic map (
  -- General --
  CLOCK_FREQUENCY   =&gt; 100000000, -- in Hz <i class="conum" data-value="1"></i><b>(1)</b>
  BOOTLOADER_EN     =&gt; true,
  USER_CODE         =&gt; x"00000000",
  ...
  -- Internal instruction memory --
  MEM_INT_IMEM_EN   =&gt; true,
  MEM_INT_IMEM_SIZE =&gt; 16*1024, <i class="conum" data-value="2"></i><b>(2)</b>
  MEM_INT_IMEM_ROM  =&gt; false,
  -- Internal data memory --
  MEM_INT_DMEM_EN   =&gt; true,
  MEM_INT_DMEM_SIZE =&gt; 8*1024, <i class="conum" data-value="3"></i><b>(3)</b>
  ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Clock frequency of <code>clk_i</code> in Hertz</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Default size of internal instruction memory: 16kB (no need to change that <em>now</em>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default size of internal data memory: 8kB (no need to change that <em>now</em>)</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>There is one generic that has to be set according to your FPGA / board: The clock frequency of the
top&#8217;s clock input signal (<code>clk_i</code>). Use the _CLOCK_FREQUENC_Y generic to specify your clock source&#8217;s
frequency in Hertz (Hz) (note "1").</p>
</li>
<li>
<p>If you feel like it – or if your FPGA does not provide so many resources – you can modify the
<strong>memory sizes</strong> (<em>MEM_INT_IMEM_SIZE</em> and <em>MEM_INT_DMEM_SIZE</em> – marked with notes "2" and "3") or even
exclude certain ISa extensions and peripheral modules from implementation - but as mentioned above, let&#8217;s keep things
simple at first and use the standard configuration for now.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keep the internal instruction and data memory sizes in mind – these values are required for setting
up the software framework in the next section <a href="#_general_software_framework_setup">General Software Framework Setup</a>.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Depending on your FPGA tool of choice, it is time to assign the signals of the test setup top entity to
the according pins of your FPGA board. All the signals can be found in the entity declaration:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 2. Entity signals of <code>neorv32_test_setup.vhd</code></div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">entity neorv32_test_setup is
  port (
    -- Global control --
    clk_i       : in std_ulogic := '0'; -- global clock, rising edge
    rstn_i      : in std_ulogic := '0'; -- global reset, low-active, async
    -- GPIO --
    gpio_o      : out std_ulogic_vector(7 downto 0); -- parallel output
    -- UART0 --
    uart0_txd_o : out std_ulogic; -- UART0 send data
    uart0_rxd_i : in std_ulogic := '0' -- UART0 receive data
);
end neorv32_test_setup;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Attach the clock input <code>clk_i</code> to your clock source and connect the reset line <code>rstn_i</code> to a button of
your FPGA board. Check whether it is low-active or high-active – the reset signal of the processor is
<strong>low-active</strong>, so maybe you need to invert the input signal.</p>
</li>
<li>
<p>If possible, connected at least bit <code>0</code> of the GPIO output port <code>gpio_o</code> to a high-active LED (invert
the signal when your LEDs are low-active) - this LED will be used as status LED by the bootloader.</p>
</li>
<li>
<p>Finally, connect the primary UART&#8217;s (UART0) communication signals <code>uart0_txd_o</code> and
<code>uart0_rxd_i</code> to your serial host interface (USB-to-serial converter).</p>
</li>
<li>
<p>Perform the project HDL compilation (synthesis, mapping, bitstream generation).</p>
</li>
<li>
<p>Download the generated bitstream into your FPGA ("program" it) and press the reset button (just to
make sure everything is sync).</p>
</li>
<li>
<p>Done! If you have assigned the bootloader status LED , it should be
flashing now and you should receive the bootloader start prompt in your UART console (check the baudrate!).</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_general_software_framework_setup">3. General Software Framework Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While your synthesis tool is crunching the NEORV32 HDL files, it is time to configure the project&#8217;s software
framework for your processor hardware setup.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>You need to tell the linker the actual size of the processor&#8217;s instruction and data memories. This has to be always sync
to the <strong>hardware memory configuration</strong> (done in section <a href="#_general_hardware_setup">General Hardware Setup</a>).</p>
</li>
<li>
<p>Open the NEORV32 linker script <code>sw/common/neorv32.ld</code> with a text editor. Right at the
beginning of the linker script you will find the <strong>MEMORY</strong> configuration showing two regions: <code>rom</code> and <code>ram</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 3. Cut-out of the linker script <code>neorv32.ld</code>: Memory configuration</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">MEMORY
{
  rom (rx) : ORIGIN = DEFINED(make_bootloader) ? 0xFFFF0000 : 0x00000000, LENGTH = DEFINED(make_bootloader) ? 4*1024 : 16*1024 <i class="conum" data-value="1"></i><b>(1)</b>
  ram (rwx) : ORIGIN = 0x80000000, LENGTH = 8*1024 <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Size of internal instruction memory (IMEM): 16kB</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Size of internal data memory (DMEM): 8kB</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>rom</code> region provides conditional assignments (via the <em>make_bootloader</em> symbol) for the <em>origin</em>
and the <em>length</em> configuration depending on whether the executable is built as normal application (for the IMEM) or
as bootloader code (for the BOOTROM). To modify the IMEM configuration of the <code>rom</code> region,
make sure to <strong>only edit the most right values</strong> for <code>ORIGIN</code> and <code>LENGTH</code> (marked with notes "1" and "2").
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>There are four parameters that are relevant here (only the right-most value for the <code>rom</code> section): The <em>origin</em>
and the <em>length</em> of the instruction memory (region name <code>rom</code>) and the <em>origin</em> and the <em>length</em> of the data
memory (region name <code>ram</code>). These four parameters have to be always sync to your hardware memory
configuration as described in section <a href="#_general_hardware_setup">General Hardware Setup</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>rom</code> <em>ORIGIN</em> parameter has to be equal to the configuration of the NEORV32 ispace_base_c
(default: 0x00000000) VHDL package (<code>rtl/core/neorv32_package.vhd</code>) configuration constant. The <code>ram</code> <em>ORIGIN</em> parameter has to
be equal to the configuration of the NEORV32 <code>dspace_base_c</code> (default: 0x80000000) VHDL
package (<code>rtl/core/neorv32_package.vhd</code>) configuration constant.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>rom</code> <em>LENGTH</em> and the <code>ram</code> <em>LENGTH</em> parameters have to match the configured memory sizes. For
instance, if the system does not have any external memories connected, the <code>rom</code> <em>LENGTH</em> parameter
has to be equal to the processor-internal IMEM size (defined via top&#8217;s <em>MEM_INT_IMEM_SIZE</em> generic)
and the <code>ram</code> <em>LENGTH</em> parameter has to be equal to the processor-internal DMEM size (defined via top&#8217;s
<em>MEM_INT_DMEM_SIZE</em> generic).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_application_program_compilation">4. Application Program Compilation</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Open a terminal console and navigate to one of the project&#8217;s example programs. For instance navigate to the
simple <code>sw/example_blink_led</code> example program. This program uses the NEORV32 GPIO unit to display
an 8-bit counter on the lowest eight bit of the <code>gpio_o</code> output port.</p>
</li>
<li>
<p>To compile the project and generate an executable simply execute:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make exe</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>This will compile and link the application sources together with all the included libraries. At the end,
your application is transformed into an ELF file (<code>main.elf</code>). The <strong>NEORV32 image generator</strong> (in <code>sw/image_gen</code>) takes this file and creates a
final executable. The makefile will show the resulting memory utilization and the executable size:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make exe
Memory utilization:
   text    data     bss    dec    hex filename
    852       0       0    852    354 main.elf
Executable (neorv32_exe.bin) size in bytes:
864</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>That&#8217;s it. The <code>exe</code> target has created the actual executable <code>neorv32_exe.bin</code> in the current
folder, which is ready to be uploaded to the processor via the bootloader&#8217;s UART interface.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The compilation process will also create a <code>main.asm</code> assembly listing file in the project directory, which
shows the actual assembly code of the complete application.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_uploading_and_starting_of_a_binary_executable_image_via_uart">5. Uploading and Starting of a Binary Executable Image via UART</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You have just created the executable. Now it is time to upload it to the processor. There are basically two
options to do so.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Executables can also be uploaded via the <strong>on-chip debugger</strong>.
See section <a href="#_debugging_with_gdb">Debugging with GDB</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Option 1</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 makefiles provide an upload target that allows to directly upload an executable from the
command line. Reset the processor and execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sw/example/blink_led$ make COM_PORT=/dev/ttyUSB1 upload</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code>/dev/ttyUSB1</code> with the actual serial port you are using to communicate with the processor. You
might have to use <code>sudo make &#8230;&#8203;</code> if the targeted device requires elevated access rights.</p>
</div>
<div class="paragraph">
<p><strong>Option 2</strong></p>
</div>
<div class="paragraph">
<p>The "better" option is to use a standard terminal program to upload an executable. This provides a more
comfortable way as you can directly interact with the bootloader console. Additionally, using a terminal program
also allows to directly communicate with the uploaded application.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Connect the primary UART (UART0) interface of your FPGA board to a serial port of your
computer or use an USB-to-serial adapter.</p>
</li>
<li>
<p>Start a terminal program. In this tutorial, I am using TeraTerm for Windows. You can download it from <a href="https://ttssh2.osdn.jp/index.html.en" class="bare">https://ttssh2.osdn.jp/index.html.en</a></p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Make sure your terminal program can transfer the executable in raw byte mode without any protocol stuff around it.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Open a connection to the corresponding srial port. Configure the terminal according to the
following parameters:</p>
<div class="ulist">
<ul>
<li>
<p>19200 Baud</p>
</li>
<li>
<p>8 data bits</p>
</li>
<li>
<p>1 stop bit</p>
</li>
<li>
<p>no parity bits</p>
</li>
<li>
<p>no transmission/flow control protocol! (just raw byte mode)</p>
</li>
<li>
<p>newline on <code>\r\n</code> (carriage return &amp; newline)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Also make sure, that single chars are transmitted without any consecutive "new line" or "carriage
return" commands (this is highly dependent on your terminal application of choice, TeraTerm only
sends the raw chars by default).</p>
</li>
<li>
<p>Press the NEORV32 reset button to restart the bootloader. The status LED starts blinking and the
bootloader intro screen appears in your console. Hurry up and press any key (hit space!) to abort the
automatic boot sequence and to start the actual bootloader user interface console.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 4. Bootloader console; aborted auto-boot sequence</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">&lt;&lt; NEORV32 Bootloader &gt;&gt;

BLDV: Mar 23 2021
HWV:  0x01050208
CLK:  0x05F5E100
USER: 0x10000DE0
MISA: 0x40901105
ZEXT: 0x00000023
PROC: 0x0EFF0037
IMEM: 0x00004000 bytes @ 0x00000000
DMEM: 0x00002000 bytes @ 0x80000000

Autoboot in 8s. Press key to abort.
Aborted.

Available commands:
h: Help
r: Restart
u: Upload
s: Store to flash
l: Load from flash
e: Execute
CMD:&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Execute the "Upload" command by typing <code>u</code>. Now the bootloader is waiting for a binary executable
to be send.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CMD:&gt; u
Awaiting neorv32_exe.bin...</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Use the "send file" option of your terminal program to transmit the previously generated binary executable <code>neorv32_exe.bin</code>.</p>
</li>
<li>
<p>Again, make sure to transmit the executable in raw binary mode (no transfer protocol, no additional
header stuff). When using TeraTerm, select the "binary" option in the send file dialog.</p>
</li>
<li>
<p>If everything went fine, OK will appear in your terminal:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CMD:&gt; u
Awaiting neorv32_exe.bin... OK</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>The executable now resides in the instruction memory of the processor. To execute the program right
now run the "Execute" command by typing <code>e</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CMD:&gt; u
Awaiting neorv32_exe.bin... OK
CMD:&gt; e
Booting...
Blinking LED demo program</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Now you should see the LEDs counting.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_of_a_new_application_program_project">6. Setup of a New Application Program Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Done with all the introduction tutorials and those example programs? Then it is time to start your own
application project!</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>The easiest way of creating a <strong>new</strong> project is to make a copy of an <strong>existing</strong> project (like the
<code>blink_led</code> project) inside the <code>sw/example</code> folder. By this, all file dependencies are kept and you can
start coding and compiling.</p>
</li>
<li>
<p>If you want to place the project folder somewhere else you need to adapt the project&#8217;s makefile. In
the makefile you will find a variable that keeps the relative or absolute path to the NEORV32 home
folder. Just modify this variable according to your new project&#8217;s home location:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># Relative or absolute path to the NEORV32 home folder (use default if not set by user)
NEORV32_HOME ?= ../../..</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>If your project contains additional source files outside of the project folder, you can add them to the <em>APP_SRC</em> variable:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># User's application sources (add additional files here)
APP_SRC = $(wildcard *.c) ../somewhere/some_file.c</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>You also need to add the folder containing the include files of your new project to the <em>APP_INC variable</em> (do not forget the <code>-I</code> prefix):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># User's application include folders (don't forget the '-I' before each entry)
APP_INC = -I . -I ../somewhere/include_stuff_folder</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>If you feel like it, you can change the default optimization level:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># Compiler effort
EFFORT = -Os</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All the assignments made to the makefile variable can also be done "inline" when invoking the makefile. For example: <code>$make EFFORT=-Os clean_all exe</code>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_risc_v_cpu_extensions">7. Enabling RISC-V CPU Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whenever you enable/disable a RISC-V CPU extensions via the according <em>CPU_EXTENSION_RISCV_x</em> generic, you need to
adapt the toolchain configuration so the compiler can actually generate according code for it.</p>
</div>
<div class="paragraph">
<p>To do so, open the makefile of your project (for example <code>sw/example/blink_led/makefile</code>) and scroll to the
"USER CONFIGURATION" section right at the beginning of the file. You need to modify the <em>MARCH</em> variable and eventually
the <em>MABI</em> variable according to your CPU hardware configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># CPU architecture and ABI
MARCH = -march=rv32i <i class="conum" data-value="1"></i><b>(1)</b>
MABI = -mabi=ilp32 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>MARCH = Machine architecture ("ISA string")</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>MABI = Machine binary interface</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example when you enable the RISC-V <code>C</code> extension (16-bit compressed instructions) via the <em>CPU_EXTENSION_RISCV_C</em> generic (set <em>true</em>) you need
to add the 'c' extension also to the <em>MARCH</em> ISA string.</p>
</div>
<div class="paragraph">
<p>You can also override the default <em>MARCH</em> and <em>MABI</em> configurations from the makefile when invoking the makefile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ make MARCH=-march=rv32ic clean_all all</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The RISC-V ISA string (for <em>MARCH</em>) follows a certain canonical structure:
<code>rev32[i/e][m][a][f][d][g][q][c][b][v][n]&#8230;&#8203;</code> For example <code>rv32imac</code> is valid while <code>rv32icma</code> is not valid.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_building_a_non_volatile_application_without_external_boot_memory">8. Building a Non-Volatile Application without External Boot Memory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The primary purpose of the bootloader is to allow an easy and fast update of the current application. In particular, this is very handy
during the development stage of a project as you can upload modified programs at any time via the UART.
Maybe at some time your project has become mature and you want to actually <em>embed</em> your processor
including the application.</p>
</div>
<div class="paragraph">
<p>There are two options to provide <em>non-volatile</em> storage of your application. The simplest (but also most constrained) one is to implement the IMEM
as true ROM to contain your program. The second option is to use an external boot memory - this concept is shown in a different section:
<a href="#_programming_an_external_spi_flash_via_the_bootloader">Programming an External SPI Flash via the Bootloader</a>.</p>
</div>
<div class="paragraph">
<p>Using the IMEM as ROM:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for this boot concept the bootloader is no longer required</p>
</li>
<li>
<p>this concept only works for the internal IMEM (but can be extended to work with external memories coupled via the processor&#8217;s bus interface)</p>
</li>
<li>
<p>make sure that the memory components (like block RAM) the IMEM is mapped to support an initialization via the bitstream</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>At first, compile your application code by running the <code>make install</code> command:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make compile
Memory utilization:
   text    data    bss    dec    hex filename
    852       0      0    852    354 main.elf
Executable (neorv32_exe.bin) size in bytes:
864
Installing application image to ../../../rtl/core/neorv32_application_image.vhd</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>The <code>install</code> target has created an executable, too, but this time also in the form of a VHDL memory
initialization file. during synthesis, this initialization will become part of the final FPGA bitstream, which
in terms initializes the IMEM&#8217;s memory primitives.</p>
</li>
<li>
<p>To allow a direct boot of this image without interference of the bootloader you <em>can</em> deactivate the implementation of
the bootloader via the according top entity&#8217;s generic:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">BOOTLOADER_EN =&gt; false, -- implement processor-internal bootloader? <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set to <em>false</em> to make the CPU directly boot from the IMEM. In this case the BOOTROM is discarded from the design.</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>When the bootloader is deactivated, the according module (BOOTROM) is removed from the design and the CPU will start booting
at the base address of the instruction memory space (IMEM base address) making the CPU directly executing your
application after reset.</p>
</li>
<li>
<p>The IMEM could be still modified, since it is implemented as RAM by default, which might corrupt your
executable. To prevent this and to implement the IMEM as true ROM (and eventually saving some
more hardware resources), active the "IMEM as ROM" feature using the processor&#8217;s according top entity
generic:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">MEM_INT_IMEM_ROM =&gt; true, -- implement processor-internal instruction memory as ROM</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Perform a new synthesis and upload your bitstream. Your application code now resides unchangeable
in the processor&#8217;s IMEM and is directly executed after reset.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_internal_bootloader">9. Customizing the Internal Bootloader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The bootloader provides several configuration options to customize it for your specific applications. The
most important user-defined configuration options are available as C <code>#defines</code> right at the beginning of the
bootloader source code <code>sw/bootloader/bootloader.c</code>):</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Cut-out from the bootloader source code <code>bootloader.c</code>: configuration parameters</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">/** UART BAUD rate */
#define BAUD_RATE (19200)
/** Enable auto-boot sequence if != 0 */
#define AUTOBOOT_EN (1)
/** Time until the auto-boot sequence starts (in seconds) */
#define AUTOBOOT_TIMEOUT 8
/** Set to 0 to disable bootloader status LED */
#define STATUS_LED_EN (1)
/** SPI_DIRECT_BOOT_EN: Define/uncomment to enable SPI direct boot */
//#define SPI_DIRECT_BOOT_EN
/** Bootloader status LED at GPIO output port */
#define STATUS_LED (0)
/** SPI flash boot image base address (warning! address might wrap-around!) */
#define SPI_FLASH_BOOT_ADR (0x00800000)
/** SPI flash chip select line at spi_csn_o */
#define SPI_FLASH_CS (0)
/** Default SPI flash clock prescaler */
#define SPI_FLASH_CLK_PRSC (CLK_PRSC_8)
/** SPI flash sector size in bytes (default = 64kb) */
#define SPI_FLASH_SECTOR_SIZE (64*1024)
/** ASCII char to start fast executable upload process */
#define FAST_UPLOAD_CMD '#'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Changing the Default Size of the Bootloader ROM</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 default bootloader uses 4kB of storage. This is also the default size of the BOOTROM memory component.
If your new/modified bootloader exceeds this size, you need to modify the boot ROM configurations.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Open the processor&#8217;s main package file <code>rtl/core/neorv32_package.vhd</code> and edit the
<code>boot_size_c</code> constant according to your requirements. The boot ROM size must not exceed 32kB
and should be a power of two (for optimal hardware mapping).</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">-- Bootloader ROM --
constant boot_size_c : natural := 4*1024; -- bytes</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Now open the NEORV32 linker script <code>sw/common/neorv32.ld</code> and adapt the <em>LENGTH</em> parameter
of the <code>rom</code> according to your new memory size. <code>boot_size_c</code> and the <code>rom</code> <em>LENGTH</em> attribute have to be always
identical. Do <strong>not modify</strong> the <em>ORIGIN</em> of the <code>rom</code> section.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">MEMORY
{
  rom (rx) : ORIGIN = DEFINED(make_bootloader) ? 0xFFFF0000 : 0x00000000, LENGTH = DEFINED(make_bootloader) ? 4*1024 : 16*1024 <i class="conum" data-value="1"></i><b>(1)</b>
  ram (rwx) : ORIGIN = 0x80000000, LENGTH = 8*1024
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bootloader ROM default size = 4*1024 bytes (<strong>left</strong> value)</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>rom</code> region provides conditional assignments (via symbol <code>make_bootloader</code>) for the origin
and the length depending on whether the executable is built as normal application (for the IMEM) or
as bootloader code (for the BOOTROM). To modify the BOOTLOADER memory size, make
sure to edit the first value for the origin (note "1").
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Re-Compiling and Re-Installing the Bootloader</strong></p>
</div>
<div class="paragraph">
<p>Whenever you have modified the bootloader you need to recompile and re-install it and re-synthesize your design.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Compile and install the bootloader using the explicit <code>bootloader</code> makefile target.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/bootloader$ make bootloader</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Now perform a new synthesis / HDL compilation to update the bitstream with the new bootloader
image (some synthesis tools also allow to only update the BRAM initialization without re-running
the entire synthesis process).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The bootloader is intended to work regardless of the actual NEORV32 hardware configuration –
especially when it comes to CPU extensions. Hence, the bootloader should be build using the
minimal <code>rv32i</code> ISA only (<code>rv32e</code> would be even better).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_programming_an_external_spi_flash_via_the_bootloader">10. Programming an External SPI Flash via the Bootloader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described in section <a href="https://stnolting.github.io/neorv32/#_external_spi_flash_for_booting">Documentation: External SPI Flash for Booting</a>
the bootloader provides an option to store an application image to an external SPI flash
and to read this image back for booting. These steps show how to store a</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>At first, reset the NEORV32 processor and wait until the bootloader start screen appears in your terminal program.</p>
</li>
<li>
<p>Abort the auto boot sequence and start the user console by pressing any key.</p>
</li>
<li>
<p>Press u to upload the program image, that you want to store to the external flash:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CMD:&gt; u
Awaiting neorv32_exe.bin...</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Send the binary in raw binary via your terminal program. When the uploaded is completed and "OK"
appears, press <code>p</code> to trigger the programming of the flash (do not execute the image via the <code>e</code>
command as this might corrupt the image):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CMD:&gt; u
Awaiting neorv32_exe.bin... OK
CMD:&gt; p
Write 0x000013FC bytes to SPI flash @ 0x00800000? (y/n)</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>The bootloader shows the size of the executable and the base address inside the SPI flash where the
executable is going to be stored. A prompt appears: Type <code>y</code> to start the programming or type <code>n</code> to
abort. See section &lt;&lt;_external_spi_flash_for_booting&gt; for more information on how to configure the base address.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CMD:&gt; u
Awaiting neorv32_exe.bin... OK
CMD:&gt; p
Write 0x000013FC bytes to SPI flash @ 0x00800000? (y/n) y
Flashing... OK
CMD:&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>If "OK" appears in the terminal line, the programming process was successful. Now you can use the
auto boot sequence to automatically boot your application from the flash at system start-up without
any user interaction.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_simulating_the_processor">11. Simulating the Processor</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Testbench</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 project features a simple default testbench (<code>sim/neorv32_tb.simple.vhd</code>) that can be used to simulate
and test the processor setup. This testbench features a 100MHz clock and enables all optional peripheral and
CPU extensions except for the <code>E</code> extension and the TRNG IO module (that CANNOT be simulated due to its
combinatorial (looped) oscillator architecture).</p>
</div>
<div class="paragraph">
<p>The simulation setup is configured via the "User Configuration" section located right at the beginning of
the testbench&#8217;s architecture. Each configuration constant provides comments to explain the functionality.</p>
</div>
<div class="paragraph">
<p>Besides the actual NEORV32 Processor, the testbench also simulates "external" components that are connected
to the processor&#8217;s external bus/memory interface. These components are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an external instruction memory (that also allows booting from it)</p>
</li>
<li>
<p>an external data memory</p>
</li>
<li>
<p>an external memory to simulate "external IO devices"</p>
</li>
<li>
<p>a memory-mapped registers to trigger the processor&#8217;s interrupt signals</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table shows the base addresses of these four components and their default configuration and
properties (attributes: <code>r</code> = read, <code>w</code> = write, <code>e</code> = execute, <code>a</code> = atomic accesses possible, <code>8</code> = byte-accessible, <code>16</code> =
half-word-accessible, <code>32</code> = word-accessible).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 1. Testbench: processor-external memories</caption>
<colgroup>
<col style="width: 17.3913%;">
<col style="width: 13.0434%;">
<col style="width: 21.7391%;">
<col style="width: 47.8262%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Base address</th>
<th class="tableblock halign-right valign-top">Size</th>
<th class="tableblock halign-center valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>imem_size_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/e,  a, 8/16/32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external IMEM (initialized with application image)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmem_size_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/e,  a, 8/16/32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external DMEM</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xf0000000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">64 bytes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/e, !a, 8/16/32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external "IO" memory, atomic accesses will fail</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xff000000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-/w/-,  a,  -/-/32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory-mapped register to trigger "machine external", "machine software" and "SoC Fast Interrupt" interrupts</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The simulated NEORV32 does not use the bootloader and directly boots the current application image (from
the <code>rtl/core/neorv32_application_image.vhd</code> image file). Make sure to use the <code>all</code> target of the
makefile to install your application as VHDL image after compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sw/example/blink_led$ make clean_all all</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Simulation-Optimized CPU/Processors Modules</div>
The <code>sim/rtl_modules</code> folder provides simulation-optimized versions of certain CPU/processor modules.
These alternatives can be used to replace the default CPU/processor HDL files to allow faster/easier/more
efficient simulation. <strong>These files are not intended for synthesis!</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Simulation Console Output</strong></p>
</div>
<div class="paragraph">
<p>Data written to the NEORV32 UART0 / UART1 transmitter is send to a virtual UART receiver implemented
as part of the testbench. Received chars are send to the simulator console and are also stored to a log file
(<code>neorv32.testbench_uart0.out</code> for UART0, <code>neorv32.testbench_uart1.out</code> for UART1) inside the simulator home folder.</p>
</div>
<div class="paragraph">
<p><strong>Faster Simulation Console Output</strong></p>
</div>
<div class="paragraph">
<p>When printing data via the UART the communication speed will always be based on the configured BAUD
rate. For a simulation this might take some time. To have faster output you can enable the <strong>simulation mode</strong>
or UART0/UART1 (see section <a href="https://stnolting.github.io/neorv32/#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Documentation: Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>).</p>
</div>
<div class="paragraph">
<p>ASCII data send to UART0 will be immediately printed to the simulator console. Additionally, the
ASCII data is logged in a file (<code>neorv32.uart0.sim_mode.text.out</code>) in the simulator home folder. All
written 32-bit data is also dumped as 8-char hexadecimal value into a file
(<code>neorv32.uart0.sim_mode.data.out</code>) also in the simulator home folder.</p>
</div>
<div class="paragraph">
<p>ASCII data send to UART1 will be immediately printed to the simulator console. Additionally, the
ASCII data is logged in a file (<code>neorv32.uart1.sim_mode.text.out</code>) in the simulator home folder. All
written 32-bit data is also dumped as 8-char hexadecimal value into a file
(<code>neorv32.uart1.sim_mode.data.out</code>) also in the simulator home folder.</p>
</div>
<div class="paragraph">
<p>You can "automatically" enable the simulation mode of UART0/UART1 when compiling an application. In this case the
"real" UART0/UART1 transmitter unit is permanently disabled. To enable the simulation mode just compile
and install your application and add <em>UART0_SIM_MODE</em> for UART0 and/or <em>UART1_SIM_MODE</em> for UART1 to
the compiler&#8217;s <em>USER_FLAGS</em> variable (do not forget the <code>-D</code> suffix flag):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sw/example/blink_led$ make USER_FLAGS+=-DUART0_SIM_MODE clean_all all</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provided define will change the default UART0/UART1 setup function in order to set the simulation mode flag in the according UART&#8217;s control register.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The UART simulation output (to file and to screen) outputs "complete lines" at once. A line is
completed with a line feed (newline, ASCII <code>\n</code> = 10).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Simulation with Xilinx Vivado</strong></p>
</div>
<div class="paragraph">
<p>The project features default a Vivado simulation waveform configuration in <code>sim/vivado</code>.</p>
</div>
<div class="paragraph">
<p><strong>Simulation with GHDL</strong></p>
</div>
<div class="paragraph">
<p>To simulate the processor using <em>GHDL</em> navigate to the <code>sim</code> folder and run the provided shell script. All arguments are passed to GHDL.
For example the simulation time can be configured using <code>--stop-time=4ms</code> as argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sim$ sh ghdl_sim.sh --stop-time=4ms</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_building_the_documentation">12. Building the Documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The documentation is written using <code>asciidoc</code>. The according source files can be found in <code>docs/&#8230;&#8203;</code>.
The documentation of the software framework is written <em>in-code</em> using <code>doxygen</code>.</p>
</div>
<div class="paragraph">
<p>A makefiles in the project&#8217;s root directory is provided to either build all of the documentation as HTML pages
or as PDF documents.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Pre-rendered PDFs are available online as nightly pre-releases: <a href="https://github.com/stnolting/neorv32/releases" class="bare">https://github.com/stnolting/neorv32/releases</a>.
The HTML-based documentation is also available online at the project&#8217;s <a href="https://stnolting.github.io/neorv32/">GitHub Pages</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The makefile provides a help target to show all available build options and their according outputs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32$ make help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 6. Example: Generate HTML documentation (data sheet) using <code>asciidoctor</code></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32$ make html</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you don&#8217;t have <code>asciidoctor</code> / <code>asciidoctor-pdf</code> installed, you can still generate all the documentation using
a <em>docker container</em> via <code>make container</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_the_project_documentation">13. Building the Project Documentation</h2>
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_freertos_support">14. FreeRTOS Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A NEORV32-specific port and a simple demo for FreeRTOS (<a href="https://github.com/FreeRTOS/FreeRTOS" class="bare">https://github.com/FreeRTOS/FreeRTOS</a>) are
available in the <code>sw/example/demo_freeRTOS</code> folder.</p>
</div>
<div class="paragraph">
<p>See the according documentation (<code>sw/example/demo_freeRTOS/README.md</code>) for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_risc_v_architecture_test_framework">15. RISC-V Architecture Test Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor passes the according tests provided by the official RISC-V Architecture Test Suite
(V2.0+), which is available online at GitHub: <a href="https://github.com/riscv/riscv-arch-test" class="bare">https://github.com/riscv/riscv-arch-test</a></p>
</div>
<div class="paragraph">
<p>All files required for executing the test framework on a simulated instance of the processor (including port
files) are located in the <code>riscv-arch-test</code> folder in the root directory of the NEORV32 repository. Take a
look at the provided <code>riscv-arch-test/README.md</code> (<a href="https://github.com/stnolting/neorv32/blob/master/riscv-arch-test/README.md">online at GitHunb</a>)
file for more information on how to run the tests and how testing is conducted in detail.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_using_the_on_chip_debugger">16. Debugging using the On-Chip Debugger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 <a href="https://stnolting.github.io/neorv32/#" class="bare">https://stnolting.github.io/neorv32/#</a><em>on_chip_debugger_ocd[Documentation: On-Chip Debugger]
allows _online</em> in-system debugging via an external JTAG access port from a
host machine. The general flow is independent of the host machine&#8217;s operating system. However, this tutorial uses
Windows and Linux (Ubuntu on Windows) in parallel.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This tutorial uses <code>gdb</code> to <strong>directly upload an executable</strong> to the processor. If you are using the default
processor setup <em>with</em> internal instruction memory (IMEM) make sure it is implemented as RAM
(<em>MEM_INT_IMEM_ROM</em> generic = false).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_hardware_requirements">16.1. Hardware Requirements</h3>
<div class="paragraph">
<p>Make sure the on-chip debugger of your NEORV32 setups is implemented (<em>ON_CHIP_DEBUGGER_EN</em> generic = true).
Connect a JTAG adapter to the NEORV32 <code>jtag_*</code> interface signals. If you do not have a full-scale JTAG adapter, you can
also use a FTDI-based adapter like the "FT2232H-56Q Mini Module", which is a simple and inexpensive FTDI breakout board.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 2. JTAG pin mapping</caption>
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 28.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">NEORV32 top signal</th>
<th class="tableblock halign-center valign-top">JTAG signal</th>
<th class="tableblock halign-center valign-top">FTDI port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TCK</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TDI</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TDO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D2</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TMS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D3</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_trst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TRST</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D4</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The low-active JTAG <em>test reset</em> (TRST) signals is <em>optional</em> as a reset can also be triggered via the TAP controller.
If TRST is not used make sure to pull the signal <em>high</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_openocd">16.2. OpenOCD</h3>
<div class="paragraph">
<p>The NEORV32 on-chip debugger can be accessed using the <a href="https://github.com/riscv/riscv-openocd">RISC-V port of OpenOCD</a>.
Prebuilt binaries can be obtained - for example - from <a href="https://www.sifive.com/software">SiFive</a>. A pre-configured
OpenOCD configuration file (<code>sw/openocd/openocd_neorv32.cfg</code>) is available that allows easy access to the NEORV32 CPU.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You might need to adapt <code>ftdi_vid_pid</code>, <code>ftdi_channel</code> and <code>ftdi_layout_init</code> in <code>sw/openocd/openocd_neorv32.cfg</code>
according to your interface chip and your operating system.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to modify the JTAG clock speed (via <code>adapter speed</code> in <code>sw/openocd/openocd_neorv32.cfg</code>) make sure to meet
the clock requirements noted in <a href="https://stnolting.github.io/neorv32/#_debug_module_dm">Documentation: Debug Transport Module (DTM)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To access the processor using OpenOCD, open a terminal and start OpenOCD with the pre-configured configuration file.</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. Connecting via OpenOCD (on Windows)</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">N:\Projects\neorv32\sw\openocd&gt;openocd -f openocd_neorv32.cfg
Open On-Chip Debugger 0.11.0-rc1+dev (SiFive OpenOCD 0.10.0-2020.12.1)
Licensed under GNU GPL v2
For bug reports:
        https://github.com/sifive/freedom-tools/issues
1
Info : Listening on port 6666 for tcl connections
Info : Listening on port 4444 for telnet connections
Info : clock speed 1000 kHz
Info : JTAG tap: neorv32.cpu tap/device found: 0x0cafe001 (mfg: 0x000 (&lt;invalid&gt;), part: 0xcafe, ver: 0x0)
Info : datacount=1 progbufsize=2
Info : Disabling abstract command reads from CSRs.
Info : Examined RISC-V core; found 1 harts
Info :  hart 0: XLEN=32, misa=0x40801105
Info : starting gdb server for neorv32.cpu.0 on 3333
Info : Listening on port 3333 for gdb connections</code></pre>
</div>
</div>
<div class="paragraph">
<p>OpenOCD has successfully connected to the NEORV32 on-chip debugger and has examined the CPU (showing the content of
the <code>misa</code> CSRs). Now you can use <code>gdb</code> to connect via port 3333.</p>
</div>
</div>
<div class="sect2">
<h3 id="_debugging_with_gdb">16.3. Debugging with GDB</h3>
<div class="paragraph">
<p>This guide uses the simple "blink example" from <code>sw/example/blink_led</code> as simplified test application to
show the basics of in-system debugging.</p>
</div>
<div class="paragraph">
<p>At first, the application needs to be compiled. We will use the minimal machine architecture configuration
(<code>rv32i</code>) here to be independent of the actual processor/CPU configuration.
Navigate to <code>sw/example/blink_led</code> and compile the application:</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. Compile the test application</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">.../neorv32/sw/example/blink_led$ make MARCH=-march=rv32i clean_all all</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate an ELF file <code>main.elf</code> that contains all the symbols required for debugging.
Furthermore, an assembly listing file <code>main.asm</code> is generated that we will use to define breakpoints.</p>
</div>
<div class="paragraph">
<p>Open another terminal in <code>sw/example/blink_led</code> and start <code>gdb</code>.
The GNU debugger is part of the toolchain (see <a href="#_toolchain_setup">Toolchain Setup</a>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. Starting GDB (on Linux (Ubuntu on Windows))</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">.../neorv32/sw/example/blink_led$ riscv32-unknown-elf-gdb
GNU gdb (GDB) 10.1
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "--host=x86_64-pc-linux-gnu --target=riscv32-unknown-elf".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type "help".
Type "apropos word" to search for commands related to "word".
(gdb)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now connect to OpenOCD using the default port 3333 on your local machine.
Set the ELF file we want to debug to the recently generated <code>main.elf</code> from the <code>blink_led</code> example.
Finally, upload the program to the processor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The executable that is uploaded to the processor is <strong>not</strong> the default NEORV32 executable (<code>neorv32_exe.bin</code>) that
is used for uploading via the bootloader. Instead, all the required sections (like <code>.text</code>) are extracted from <code>mail.elf</code>
by GDB and uploaded via the debugger&#8217;s indirect memory access.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 10. Running GDB</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">(gdb) target remote localhost:3333 <i class="conum" data-value="1"></i><b>(1)</b>
Remote debugging using localhost:3333
warning: No executable has been specified and target does not support
determining executable automatically.  Try using the "file" command.
0xffff0c94 in ?? () <i class="conum" data-value="2"></i><b>(2)</b>
(gdb) file main.elf <i class="conum" data-value="3"></i><b>(3)</b>
A program is being debugged already.
Are you sure you want to change the file? (y or n) y
Reading symbols from main.elf...
(gdb) load <i class="conum" data-value="4"></i><b>(4)</b>
Loading section .text, size 0xd0c lma 0x0
Loading section .rodata, size 0x39c lma 0xd0c
Start address 0x00000000, load size 4264
Transfer rate: 43 KB/sec, 2132 bytes/write.
(gdb)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Connect to OpenOCD</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The CPU was still executing code from the bootloader ROM - but that does not matter here</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Select <code>mail.elf</code> from the <code>blink_led</code> example</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Upload the executable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the upload, GDB will make the processor jump to the beginning of the uploaded executable
(by default, this is the beginning of the instruction memory at <code>0x00000000</code>) skipping the bootloader
and halting the CPU right before executing the <code>blink_led</code> application.</p>
</div>
<div class="sect3">
<h4 id="_breakpoint_example">16.3.1. Breakpoint Example</h4>
<div class="paragraph">
<p>The following steps are just a small showcase that illustrate a simple debugging scheme.</p>
</div>
<div class="paragraph">
<p>While compiling <code>blink_led</code>, an assembly listing file <code>main.asm</code> was generated.
Open this file with a text editor to check out what the CPU is going to do when resumed.</p>
</div>
<div class="paragraph">
<p>The <code>blink_led</code> example implements a simple counter on the 8 lowest GPIO output ports. The program uses
"busy wait" to have a visible delay between increments. This waiting is done by calling the <code>neorv32_cpu_delay_ms</code>
function. We will add a <em>breakpoint</em> right at the end of this wait function so we can step through the iterations
of the counter.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Cut-out from <code>main.asm</code> generated from the <code>blink_led</code> example</div>
<div class="content">
<pre class="highlight"><code class="language-assembly" data-lang="assembly">00000688 &lt;__neorv32_cpu_delay_ms_end&gt;:
 688:	01c12083          	lw	ra,28(sp)
 68c:	02010113          	addi	sp,sp,32
 690:	00008067          	ret</code></pre>
</div>
</div>
<div class="paragraph">
<p>The very last instruction of the <code>neorv32_cpu_delay_ms</code> function is <code>ret</code> (= return)
at hexadecimal <code>690</code> in this example. Add this address as <em>breakpoint</em> to GDB.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The address might be different if you use a different version of the software framework or
if different ISA options are configured.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 12. Adding a GDB breakpoint</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">(gdb) b * 0x690
Breakpoint 1 at 0x690</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now execute <code>c</code> (= continue). The CPU will resume operation until it hits the break-point.
By this we can "step" from increment to increment.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. Iterating from breakpoint to breakpoint</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Breakpoint 1 at 0x690
(gdb) c
Continuing.

Breakpoint 1, 0x00000690 in neorv32_cpu_delay_ms ()
(gdb) c
Continuing.

Breakpoint 1, 0x00000690 in neorv32_cpu_delay_ms ()
(gdb) c
Continuing.</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal">17. Legal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph">
<p><strong>BSD 3-Clause License</strong></p>
</div>
<div class="paragraph">
<p>Copyright (c) 2021, Stephan Nolting. All rights reserved.</p>
</div>
<div class="paragraph">
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that
the following conditions are met:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the
following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or
promote products derived from this software without specific prior written permission.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>The NEORV32 RISC-V Processor</strong><br>
Copyright (c) 2021, by Dipl.-Ing. Stephan Nolting. All rights reserved.<br>
HQ: <a href="https://github.com/stnolting/neorv32" class="bare">https://github.com/stnolting/neorv32</a><br>
Contact: <a href="mailto:stnolting@gmail.com">stnolting@gmail.com</a><br>
<em>made in Hanover, Germany</em></p>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_proprietary_notice">Proprietary Notice</h3>
<div class="ulist">
<ul>
<li>
<p>"GitHub" is a Subsidiary of Microsoft Corporation.</p>
</li>
<li>
<p>"Vivado" and "Artix" are trademarks of Xilinx Inc.</p>
</li>
<li>
<p>"AXI" and "AXI4-Lite" are trademarks of Arm Holdings plc.</p>
</li>
<li>
<p>"ModelSim" is a trademark of Mentor Graphics – A Siemens Business.</p>
</li>
<li>
<p>"Quartus Prime" and "Cyclone" are trademarks of Intel Corporation.</p>
</li>
<li>
<p>"iCE40", "UltraPlus" and "Radiant" are trademarks of Lattice Semiconductor Corporation.</p>
</li>
<li>
<p>"Windows" is a trademark of Microsoft Corporation.</p>
</li>
<li>
<p>"Tera Term" copyright by T. Teranishi.</p>
</li>
<li>
<p>Timing diagrams made with WaveDrom Editor.</p>
</li>
<li>
<p>"NeoPixel" is a trademark of Adafruit Industries.</p>
</li>
<li>
<p>Documentation made with <code>asciidoctor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PDF icons from <a href="https://www.flaticon.com" class="bare">https://www.flaticon.com</a> and made by
<a href="https://www.freepik.com">Freepik</a>, <a href="https://www.flaticon.com/authors/good-ware">Good Ware</a>,
<a href="https://www.flaticon.com/authors/pixel-perfect">Pixel perfect</a>, <a href="https://www.flaticon.com/authors/vectors-market">Vectors Market</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_disclaimer">Disclaimer</h3>
<div class="paragraph">
<p>This project is released under the BSD 3-Clause license. No copyright infringement
intended. Other implied or used projects might have different licensing – see their documentation to get more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limitation_of_liability_for_external_links">Limitation of Liability for External Links</h3>
<div class="paragraph">
<p>This document contains links to the websites of third parties ("external links"). As the content of these websites
is not under our control, we cannot assume any liability for such external content. In all cases, the provider of
information of the linked websites is liable for the content and accuracy of the information provided. At the
point in time when the links were placed, no infringements of the law were recognizable to us. As soon as an
infringement of the law becomes known to us, we will immediately remove the link in question.</p>
</div>
</div>
<div class="sect2">
<h3 id="_citing">Citing</h3>
<div class="paragraph">
<p>If you are using the NEORV32 or parts of the project in some kind of publication, please cite it as follows:</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. BibTeX</div>
<div class="content">
<pre class="highlight"><code>@misc{nolting20,
  author       = {Nolting, S.},
  title        = {The NEORV32 RISC-V Processor},
  year         = {2020},
  publisher    = {GitHub},
  journal      = {GitHub repository},
  howpublished = {\url{https://github.com/stnolting/neorv32}}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgments">Acknowledgments</h3>
<div class="paragraph">
<p><strong>A big shoutout to all <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a>,
who helped improving this project! ❤️</strong></p>
</div>
<div class="paragraph">
<p><a href="https://riscv.org">RISC-V</a> - instruction sets want to be free!</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version v1.5.6.0-r163-g0d5303f<br>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>